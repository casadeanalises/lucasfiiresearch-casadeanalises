import { NextResponse } from "next/server";
import { auth } from "@clerk/nextjs/server";

export const dynamic = "force-dynamic";

// Função para buscar FIIs da API externa (simulada por enquanto)
async function fetchFIIsFromExternalAPI() {
  // Em um cenário real, você faria uma requisição para uma API externa
  // como a da B3, FundsExplorer ou outra API que forneça dados de FIIs

  // Simulando uma resposta com dados mockados
  return [
    {
      codigo: "HGLG11",
      nome: "CSHG Logística FII",
      setor: "Logística",
      preco: 172.05,
      valorPatrimonial: 165.89,
      dividendYield: 0.78,
      liquidezDiaria: 3456000,
      valoracaoPVP: 1.04,
      rentabilidadeMes: 2.34,
      rentabilidadeAno: 11.25,
      ultimoRendimento: 1.25,
      dataUltimoInfoorme: "15/06/2023",
    },
    {
      codigo: "KNRI11",
      nome: "Kinea Renda Imobiliária FII",
      setor: "Lajes Corporativas",
      preco: 132.4,
      valorPatrimonial: 139.76,
      dividendYield: 0.65,
      liquidezDiaria: 5123000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 1.85,
      rentabilidadeAno: 8.76,
      ultimoRendimento: 0.85,
      dataUltimoInfoorme: "10/06/2023",
    },
    {
      codigo: "MXRF11",
      nome: "Maxi Renda FII",
      setor: "Recebíveis",
      preco: 10.25,
      valorPatrimonial: 9.87,
      dividendYield: 1.12,
      liquidezDiaria: 8754000,
      valoracaoPVP: 1.04,
      rentabilidadeMes: 1.15,
      rentabilidadeAno: 12.45,
      ultimoRendimento: 0.11,
      dataUltimoInfoorme: "18/06/2023",
    },
    {
      codigo: "XPLG11",
      nome: "XP Log FII",
      setor: "Logística",
      preco: 102.8,
      valorPatrimonial: 111.23,
      dividendYield: 0.8,
      liquidezDiaria: 2875000,
      valoracaoPVP: 0.92,
      rentabilidadeMes: 3.25,
      rentabilidadeAno: 10.35,
      ultimoRendimento: 0.82,
      dataUltimoInfoorme: "20/06/2023",
    },
    {
      codigo: "HGBS11",
      nome: "CSHG Brasil Shopping FII",
      setor: "Shopping",
      preco: 205.75,
      valorPatrimonial: 210.86,
      dividendYield: 0.76,
      liquidezDiaria: 1985000,
      valoracaoPVP: 0.98,
      rentabilidadeMes: 2.15,
      rentabilidadeAno: 9.85,
      ultimoRendimento: 1.55,
      dataUltimoInfoorme: "12/06/2023",
    },
    {
      codigo: "VISC11",
      nome: "Vinci Shopping Centers FII",
      setor: "Shopping",
      preco: 104.5,
      valorPatrimonial: 107.25,
      dividendYield: 0.72,
      liquidezDiaria: 2340000,
      valoracaoPVP: 0.97,
      rentabilidadeMes: 1.95,
      rentabilidadeAno: 8.45,
      ultimoRendimento: 0.75,
      dataUltimoInfoorme: "14/06/2023",
    },
    {
      codigo: "HFOF11",
      nome: "Hedge TOP FOF FII",
      setor: "Fundo de Fundos",
      preco: 85.2,
      valorPatrimonial: 89.68,
      dividendYield: 0.85,
      liquidezDiaria: 1875000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 2.18,
      rentabilidadeAno: 9.35,
      ultimoRendimento: 0.72,
      dataUltimoInfoorme: "16/06/2023",
    },
    {
      codigo: "BTLG11",
      nome: "BTG Pactual Logística FII",
      setor: "Logística",
      preco: 98.75,
      valorPatrimonial: 101.23,
      dividendYield: 0.79,
      liquidezDiaria: 2156000,
      valoracaoPVP: 0.97,
      rentabilidadeMes: 2.05,
      rentabilidadeAno: 9.65,
      ultimoRendimento: 0.78,
      dataUltimoInfoorme: "13/06/2023",
    },
    {
      codigo: "RECT11",
      nome: "REC Renda Imobiliária FII",
      setor: "Híbrido",
      preco: 67.89,
      valorPatrimonial: 72.15,
      dividendYield: 0.95,
      liquidezDiaria: 1542000,
      valoracaoPVP: 0.94,
      rentabilidadeMes: 1.75,
      rentabilidadeAno: 10.05,
      ultimoRendimento: 0.65,
      dataUltimoInfoorme: "11/06/2023",
    },
    {
      codigo: "KNCR11",
      nome: "Kinea Rendimentos Imobiliários FII",
      setor: "Recebíveis",
      preco: 96.35,
      valorPatrimonial: 98.72,
      dividendYield: 1.05,
      liquidezDiaria: 2875000,
      valoracaoPVP: 0.98,
      rentabilidadeMes: 0.95,
      rentabilidadeAno: 11.35,
      ultimoRendimento: 1.01,
      dataUltimoInfoorme: "09/06/2023",
    },
    {
      codigo: "XPIN11",
      nome: "XP Industrial FII",
      setor: "Industrial",
      preco: 93.45,
      valorPatrimonial: 97.82,
      dividendYield: 0.82,
      liquidezDiaria: 1425000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 1.85,
      rentabilidadeAno: 8.95,
      ultimoRendimento: 0.76,
      dataUltimoInfoorme: "17/06/2023",
    },
    {
      codigo: "HSML11",
      nome: "HSI Malls FII",
      setor: "Shopping",
      preco: 87.62,
      valorPatrimonial: 91.45,
      dividendYield: 0.71,
      liquidezDiaria: 1675000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.65,
      rentabilidadeAno: 7.85,
      ultimoRendimento: 0.62,
      dataUltimoInfoorme: "15/06/2023",
    },
    {
      codigo: "VILG11",
      nome: "Vinci Logística FII",
      setor: "Logística",
      preco: 105.35,
      valorPatrimonial: 108.75,
      dividendYield: 0.77,
      liquidezDiaria: 2235000,
      valoracaoPVP: 0.97,
      rentabilidadeMes: 2.25,
      rentabilidadeAno: 10.15,
      ultimoRendimento: 0.81,
      dataUltimoInfoorme: "19/06/2023",
    },
    {
      codigo: "RBVA11",
      nome: "Rio Bravo Renda Varejo FII",
      setor: "Varejo",
      preco: 112.75,
      valorPatrimonial: 117.85,
      dividendYield: 0.68,
      liquidezDiaria: 1345000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.55,
      rentabilidadeAno: 8.25,
      ultimoRendimento: 0.77,
      dataUltimoInfoorme: "14/06/2023",
    },
    {
      codigo: "RCRB11",
      nome: "Rio Bravo Renda Corporativa FII",
      setor: "Lajes Corporativas",
      preco: 125.85,
      valorPatrimonial: 131.45,
      dividendYield: 0.62,
      liquidezDiaria: 1565000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.45,
      rentabilidadeAno: 7.75,
      ultimoRendimento: 0.78,
      dataUltimoInfoorme: "13/06/2023",
    },
    {
      codigo: "BBPO11",
      nome: "BB Progressivo II FII",
      setor: "Lajes Corporativas",
      preco: 86.24,
      valorPatrimonial: 91.38,
      dividendYield: 0.73,
      liquidezDiaria: 1254000,
      valoracaoPVP: 0.94,
      rentabilidadeMes: 1.23,
      rentabilidadeAno: 8.71,
      ultimoRendimento: 0.52,
      dataUltimoInfoorme: "08/06/2023",
    },
    {
      codigo: "BCFF11",
      nome: "BTG Pactual Fundo de Fundos FII",
      setor: "Fundo de Fundos",
      preco: 71.15,
      valorPatrimonial: 75.37,
      dividendYield: 0.92,
      liquidezDiaria: 1875000,
      valoracaoPVP: 0.94,
      rentabilidadeMes: 1.85,
      rentabilidadeAno: 9.15,
      ultimoRendimento: 0.65,
      dataUltimoInfoorme: "12/06/2023",
    },
    {
      codigo: "BRCR11",
      nome: "BTG Pactual Corporate Office FII",
      setor: "Lajes Corporativas",
      preco: 67.98,
      valorPatrimonial: 72.53,
      dividendYield: 0.69,
      liquidezDiaria: 1350000,
      valoracaoPVP: 0.94,
      rentabilidadeMes: 1.05,
      rentabilidadeAno: 7.32,
      ultimoRendimento: 0.39,
      dataUltimoInfoorme: "11/06/2023",
    },
    {
      codigo: "HGRU11",
      nome: "CSHG Renda Urbana FII",
      setor: "Híbrido",
      preco: 115.35,
      valorPatrimonial: 119.75,
      dividendYield: 0.82,
      liquidezDiaria: 2145000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.95,
      rentabilidadeAno: 9.45,
      ultimoRendimento: 0.95,
      dataUltimoInfoorme: "14/06/2023",
    },
    {
      codigo: "IRDM11",
      nome: "Iridium Recebíveis Imobiliários FII",
      setor: "Recebíveis",
      preco: 105.32,
      valorPatrimonial: 108.76,
      dividendYield: 1.18,
      liquidezDiaria: 2340000,
      valoracaoPVP: 0.97,
      rentabilidadeMes: 1.13,
      rentabilidadeAno: 12.82,
      ultimoRendimento: 1.03,
      dataUltimoInfoorme: "12/06/2023",
    },
    {
      codigo: "JSRE11",
      nome: "JS Real Estate Multigestão FII",
      setor: "Híbrido",
      preco: 87.43,
      valorPatrimonial: 92.15,
      dividendYield: 0.72,
      liquidezDiaria: 1432000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 1.54,
      rentabilidadeAno: 8.67,
      ultimoRendimento: 0.53,
      dataUltimoInfoorme: "13/06/2023",
    },
    {
      codigo: "MALL11",
      nome: "Malls Brasil Plural FII",
      setor: "Shopping",
      preco: 93.28,
      valorPatrimonial: 97.65,
      dividendYield: 0.74,
      liquidezDiaria: 1568000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.82,
      rentabilidadeAno: 8.94,
      ultimoRendimento: 0.58,
      dataUltimoInfoorme: "15/06/2023",
    },
    {
      codigo: "PVBI11",
      nome: "VBI Prime Properties FII",
      setor: "Lajes Corporativas",
      preco: 88.95,
      valorPatrimonial: 93.45,
      dividendYield: 0.75,
      liquidezDiaria: 1435000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 1.45,
      rentabilidadeAno: 8.15,
      ultimoRendimento: 0.67,
      dataUltimoInfoorme: "18/06/2023",
    },
    {
      codigo: "RBRP11",
      nome: "RBR Properties FII",
      setor: "Lajes Corporativas",
      preco: 62.34,
      valorPatrimonial: 67.82,
      dividendYield: 0.73,
      liquidezDiaria: 1245000,
      valoracaoPVP: 0.92,
      rentabilidadeMes: 1.63,
      rentabilidadeAno: 8.34,
      ultimoRendimento: 0.38,
      dataUltimoInfoorme: "14/06/2023",
    },
    {
      codigo: "VGIP11",
      nome: "Valora CRI Índice de Preço FII",
      setor: "Recebíveis",
      preco: 92.45,
      valorPatrimonial: 96.82,
      dividendYield: 1.15,
      liquidezDiaria: 1654000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 1.25,
      rentabilidadeAno: 12.85,
      ultimoRendimento: 1.06,
      dataUltimoInfoorme: "15/06/2023",
    },
    {
      codigo: "XPML11",
      nome: "XP Malls FII",
      setor: "Shopping",
      preco: 95.75,
      valorPatrimonial: 99.85,
      dividendYield: 0.69,
      liquidezDiaria: 2345000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.75,
      rentabilidadeAno: 8.95,
      ultimoRendimento: 0.66,
      dataUltimoInfoorme: "16/06/2023",
    },
    {
      codigo: "ALZR11",
      nome: "Alianza Trust Renda Imobiliária FII",
      setor: "Logística",
      preco: 112.45,
      valorPatrimonial: 118.76,
      dividendYield: 0.75,
      liquidezDiaria: 1435000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 1.89,
      rentabilidadeAno: 9.12,
      ultimoRendimento: 0.7,
      dataUltimoInfoorme: "12/06/2023",
    },
    {
      codigo: "BPFF11",
      nome: "Brasil Plural Absoluto FII",
      setor: "Fundo de Fundos",
      preco: 75.67,
      valorPatrimonial: 79.34,
      dividendYield: 0.88,
      liquidezDiaria: 1320000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 1.53,
      rentabilidadeAno: 9.45,
      ultimoRendimento: 0.55,
      dataUltimoInfoorme: "13/06/2023",
    },
    {
      codigo: "FVBI11",
      nome: "VBI Prime Properties",
      setor: "Lajes Corporativas",
      preco: 89.34,
      valorPatrimonial: 94.56,
      dividendYield: 0.67,
      liquidezDiaria: 1125000,
      valoracaoPVP: 0.94,
      rentabilidadeMes: 1.32,
      rentabilidadeAno: 7.65,
      ultimoRendimento: 0.5,
      dataUltimoInfoorme: "14/06/2023",
    },
    {
      codigo: "GALG11",
      nome: "Guardian Logística FII",
      setor: "Logística",
      preco: 118.72,
      valorPatrimonial: 123.45,
      dividendYield: 0.76,
      liquidezDiaria: 1567000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 2.08,
      rentabilidadeAno: 9.87,
      ultimoRendimento: 0.75,
      dataUltimoInfoorme: "15/06/2023",
    },
    {
      codigo: "HCTR11",
      nome: "Hectare CE FII",
      setor: "Recebíveis",
      preco: 102.85,
      valorPatrimonial: 106.75,
      dividendYield: 1.12,
      liquidezDiaria: 1785000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.35,
      rentabilidadeAno: 12.45,
      ultimoRendimento: 1.15,
      dataUltimoInfoorme: "19/06/2023",
    },
    {
      codigo: "PLCR11",
      nome: "Plural Recebiveis FII",
      setor: "Recebíveis",
      preco: 94.25,
      valorPatrimonial: 98.34,
      dividendYield: 1.06,
      liquidezDiaria: 1347000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.17,
      rentabilidadeAno: 11.45,
      ultimoRendimento: 0.83,
      dataUltimoInfoorme: "10/06/2023",
    },
    {
      codigo: "RBRF11",
      nome: "RBR Alpha Multiestratégia Real Estate FII",
      setor: "Fundo de Fundos",
      preco: 82.45,
      valorPatrimonial: 86.78,
      dividendYield: 0.85,
      liquidezDiaria: 1574000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 1.75,
      rentabilidadeAno: 9.34,
      ultimoRendimento: 0.58,
      dataUltimoInfoorme: "16/06/2023",
    },
    {
      codigo: "SDIL11",
      nome: "SDI Logística FII",
      setor: "Logística",
      preco: 82.45,
      valorPatrimonial: 86.35,
      dividendYield: 0.81,
      liquidezDiaria: 1565000,
      valoracaoPVP: 0.95,
      rentabilidadeMes: 1.95,
      rentabilidadeAno: 9.75,
      ultimoRendimento: 0.67,
      dataUltimoInfoorme: "20/06/2023",
    },
    {
      codigo: "VINO11",
      nome: "Vinci Offices FII",
      setor: "Lajes Corporativas",
      preco: 78.45,
      valorPatrimonial: 83.21,
      dividendYield: 0.68,
      liquidezDiaria: 1356000,
      valoracaoPVP: 0.94,
      rentabilidadeMes: 1.43,
      rentabilidadeAno: 7.86,
      ultimoRendimento: 0.44,
      dataUltimoInfoorme: "13/06/2023",
    },
    {
      codigo: "VIUR11",
      nome: "Vinci Imóveis Urbanos FII",
      setor: "Híbrido",
      preco: 103.24,
      valorPatrimonial: 107.87,
      dividendYield: 0.72,
      liquidezDiaria: 1427000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.67,
      rentabilidadeAno: 8.74,
      ultimoRendimento: 0.62,
      dataUltimoInfoorme: "14/06/2023",
    },
    {
      codigo: "RBRR11",
      nome: "RBR High Grade FII",
      setor: "Recebíveis",
      preco: 98.45,
      valorPatrimonial: 102.35,
      dividendYield: 1.08,
      liquidezDiaria: 1965000,
      valoracaoPVP: 0.96,
      rentabilidadeMes: 1.15,
      rentabilidadeAno: 11.85,
      ultimoRendimento: 1.06,
      dataUltimoInfoorme: "17/06/2023",
    },
    {
      codigo: "GGRC11",
      nome: "GGR Covepi Renda FII",
      setor: "Logística",
      preco: 108.65,
      valorPatrimonial: 112.45,
      dividendYield: 0.78,
      liquidezDiaria: 1875000,
      valoracaoPVP: 0.97,
      rentabilidadeMes: 2.15,
      rentabilidadeAno: 10.25,
      ultimoRendimento: 0.85,
      dataUltimoInfoorme: "13/06/2023",
    },
  ];
}

// GET - Buscar lista de FIIs disponíveis
export async function GET() {
  try {
    const { userId } = auth();
    if (!userId) {
      return NextResponse.json({ error: "Não autorizado" }, { status: 401 });
    }

    // Buscar FIIs da API externa
    const fiis = await fetchFIIsFromExternalAPI();

    return NextResponse.json({ fiis });
  } catch (error) {
    console.error("Erro ao buscar FIIs:", error);
    return NextResponse.json(
      { error: "Erro ao buscar lista de FIIs" },
      { status: 500 },
    );
  }
}
